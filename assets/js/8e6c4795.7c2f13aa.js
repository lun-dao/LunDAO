"use strict";(self.webpackChunklun_dao=self.webpackChunklun_dao||[]).push([[9818],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>c});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)a=l[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var h=n.createContext({}),p=function(e){var t=n.useContext(h),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},m=function(e){var t=p(e.components);return n.createElement(h.Provider,{value:t},e.children)},k="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,l=e.originalType,h=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),k=p(a),d=r,c=k["".concat(h,".").concat(d)]||k[d]||s[d]||l;return a?n.createElement(c,i(i({ref:t},m),{},{components:a})):n.createElement(c,i({ref:t},m))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=a.length,i=new Array(l);i[0]=d;var o={};for(var h in t)hasOwnProperty.call(t,h)&&(o[h]=t[h]);o.originalType=e,o[k]="string"==typeof e?e:r,i[1]=o;for(var p=2;p<l;p++)i[p]=a[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5288:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>h,contentTitle:()=>i,default:()=>s,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const l={title:"Hardhat mainnet forking\uff1a\u4e3b\u7db2\u5206\u53c9 (1)",description:"\u5982\u4f55\u5229\u7528 Hardhat \u9032\u884c\u4e3b\u7db2\u5206\u53c9",slug:"hardhat-forking-1",tags:["Mainnet Fork","Mainnet Forking","Hardhat","Nomic Labs"],authors:"a2468834"},i=void 0,o={permalink:"/blog/hardhat-forking-1",editUrl:"https://github.com/lun-dao/LunDAO/tree/main/blog/2022-03-23-hardhat-forking/hardhat-forking-1.md",source:"@site/blog/2022-03-23-hardhat-forking/hardhat-forking-1.md",title:"Hardhat mainnet forking\uff1a\u4e3b\u7db2\u5206\u53c9 (1)",description:"\u5982\u4f55\u5229\u7528 Hardhat \u9032\u884c\u4e3b\u7db2\u5206\u53c9",date:"2022-03-23T00:00:00.000Z",formattedDate:"March 23, 2022",tags:[{label:"Mainnet Fork",permalink:"/blog/tags/mainnet-fork"},{label:"Mainnet Forking",permalink:"/blog/tags/mainnet-forking"},{label:"Hardhat",permalink:"/blog/tags/hardhat"},{label:"Nomic Labs",permalink:"/blog/tags/nomic-labs"}],readingTime:12.56,truncated:!0,authors:[{name:"Chuan-Chun Wang",url:"https://github.com/a2468834",imageURL:"https://github.com/a2468834.png",key:"a2468834"}],prevItem:{title:"Diamond 101 (1)",permalink:"/blog/diamond101"},nextItem:{title:"Hardhat mainnet forking\uff1a\u4e3b\u7db2\u5206\u53c9 (2)",permalink:"/blog/hardhat-forking-2"}},h={authorsImageUrls:[void 0]},p=[{value:"\u80cc\u666f\u77e5\u8b58\u8207\u74b0\u5883",id:"\u80cc\u666f\u77e5\u8b58\u8207\u74b0\u5883",children:[],level:2},{value:"\u91cd\u8981\u5fc5\u5099\u689d\u4ef6",id:"\u91cd\u8981\u5fc5\u5099\u689d\u4ef6",children:[],level:2},{value:"Step 1\uff1a\u5efa\u7f6e\u74b0\u5883",id:"step-1\u5efa\u7f6e\u74b0\u5883",children:[],level:2},{value:"Step 2\uff1a\u8abf\u6574 <code>hardhat.config.js</code>",id:"step-2\u8abf\u6574-hardhatconfigjs",children:[],level:2},{value:"Step 3\uff1a\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7684 Hardhat task <code>height</code>",id:"step-3\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7684-hardhat-task-height",children:[],level:2},{value:"Related resources",id:"related-resources",children:[],level:2},{value:"Further reading",id:"further-reading",children:[],level:2}],m={toc:p},k="wrapper";function s(e){let{components:t,...a}=e;return(0,r.kt)(k,(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u672c\u6587\u7ae0\u5c07\u5c55\u793a\u600e\u9ebc\u4f7f\u7528\u77e5\u540d\u958b\u767c\u5de5\u5177 Hardhat \u7684\u4e3b\u7db2\u5206\u53c9\uff08mainnet forking\uff09\uff0c\u4ee4\u958b\u767c\u8005\u53ef\u4efb\u610f\u6307\u5b9a\u6b32\u5206\u53c9\u7684\u5340\u584a\u93c8\u9ad8\u5ea6\uff0c\u4e26\u8207 Hardhat \u5167\u5efa\u7684\u81ea\u5b9a\u7fa9 testnet\uff08Hardhat Network\uff09\u7d50\u5408\uff0c\u4eab\u53d7\u6700\u9ad8\u4eff\u771f\u5ea6\u3001\u6700\u7c21\u4fbf\u7684\u958b\u767c\u74b0\u5883\u3002"),(0,r.kt)("p",null,"\u5728 Ethereum \u958b\u767c Dapp \u5c11\u4e0d\u4e86\u64b0\u5beb\u667a\u80fd\u5408\u7d04\uff08smart contract\uff09\uff1b\u9664\u4e86\u4f7f\u7528 Go Ethereum\uff08Geth\uff09\u3001OpenEthereum \u7b49\u5de5\u5177\u81ea\u5efa\u4e00\u689d local testnet\uff0c\u4e26\u5c07\u5408\u7d04\u90e8\u5c6c\u5728\u4e0a\u9762\u4e4b\u5916\uff0c\u9084\u53ef\u5c07\u5408\u7d04\u90e8\u5c6c\u5230\u5404\u5927\u516c\u958b\u6e2c\u8a66\u7db2\uff08testnet\uff09",(0,r.kt)("sup",{parentName:"p",id:"fnref-1"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),"\u3002\u7136\u800c\uff0c\u9019\u4e9b\u65b9\u6cd5\u96d6\u7136\u90fd\u4f7f\u7528\u8207\u4e3b\u7db2\uff08mainnet\uff09\u5e7e\u4e4e\u76f8\u540c\u7684",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),"\u7a0b\u5f0f\u78bc\u7576\u4f5c L1 \u5e95\u5c64\uff0c\u4f46\u662f\u8207\u76f4\u63a5\u90e8\u5c6c\u5728 mainnet \u6700\u5927\u7684\u5dee\u7570\u5c31\u662f\uff1a\u4f60\u5e7e\u4e4e\u7121\u6cd5\u8b93\u4f60\u7684 Dapp \u8207\u5176\u4ed6\u77e5\u540d\u5408\u7d04\u3001DEX \u505a\u4e92\u52d5\u3002"),(0,r.kt)("p",null,"DeFi \u4e4b\u6240\u4ee5\u5728\u8fd1\u5e74\u53d7\u5230\u5168\u7403\u77da\u76ee\uff0c\u5176\u4e2d\u4e00\u500b\u539f\u56e0\u83ab\u904e\u65bc\u5176\u9ad8\u5ea6\u7684\u4e92\u64cd\u4f5c\u6027\uff08interoperability\uff09\uff1b\u5404\u500b\u5408\u7d04\u4e4b\u9593\u53ef\u4ee5\u900f\u904e\u7a0b\u5f0f\u547c\u53eb\uff0c\u8f15\u9b06\u5730\u8207\u5f7c\u6b64\u4e92\u52d5\uff0c\u9054\u6210\u50b3\u7d71\u91d1\u878d\u6240\u7121\u6cd5\u4f01\u53ca\u7684\u5de8\u5927\u9748\u6d3b\u80fd\u529b\u3002"),(0,r.kt)("p",null,"\u7136\u800c\uff0c\u5982\u679c\u4f60\u6b63\u5728\u958b\u767c\u7684 Dapp/DeFi \u5c08\u6848\uff0c\u7121\u6cd5\u5728\u6975\u5ea6\u4eff\u771f\u7684\u74b0\u5883\u7576\u4e2d\uff0c\u901a\u904e\u5b8c\u6574\u7684\u6e2c\u8a66\u5373\u8cbf\u7136\u4e0a\u7dda\uff0c\u5247\u6b64\u670d\u52d9\u5c07\u66b4\u9732\u65bc\u5de8\u5927\u98a8\u96aa\u4e4b\u4e0b\u3002"),(0,r.kt)("p",null,"\u90e8\u5c6c\u5408\u7d04\u65bc (local) testnet \u7576\u4e2d\uff0c\u70ba\u6c42\u6700\u7cbe\u7dfb\u7684\u6a21\u64ec\u74b0\u5883\uff0c\u4f60\u5c07\u6703\u8017\u8cbb\u6975\u5927\u5fc3\u529b\u9010\u4e00\u8907\u88fd\u6240\u6709\u7b2c\u4e09\u65b9\u5408\u7d04\u3001DEX \u7684\u7a0b\u5f0f\u78bc\uff0c\u4e26\u91cd\u65b0\u4f48\u7f72\u65bc\u6a21\u64ec\u74b0\u5883\u7576\u4e2d\uff0c\u9019\u5b8c\u5168\u4e0d\u662f\u4e00\u500b\u53ef\u884c\u7684\u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"Hardhat \u7684\u8aaa\u660e\u6587\u4ef6\u662f\u9019\u9ebc\u4ecb\u7d39 mainnet forking\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You can start an instance of Hardhat Network that forks mainnet. ",(0,r.kt)("strong",{parentName:"p"},"This means that it will simulate having the same state as mainnet"),", but it will work as a local development network. ",(0,r.kt)("sup",{parentName:"p",id:"fnref-3"},(0,r.kt)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3")))),(0,r.kt)("p",null,"\u672c\u6587\u7ae0\u5c07\u5e36\u9818\u5404\u4f4d\u8b80\u8005\u719f\u6089 mainnet forking \u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u4e26\u5728\u53e6\u4e00\u7bc7\u6587\u7ae0\u7576\u4e2d\u8209\u5e7e\u500b\u4f8b\u5b50\u8b93\u8b80\u8005\u80fd\u9ad4\u6703 mainnet forking \u7684\u65b9\u4fbf\u6027\uff0c\u4ee5\u671f\u5404\u4f4d\u8b80\u8005\u90fd\u80fd\u5584\u7528\u6b64\u5de5\u5177\u3002"),(0,r.kt)("h2",{id:"\u80cc\u666f\u77e5\u8b58\u8207\u74b0\u5883"},"\u80cc\u666f\u77e5\u8b58\u8207\u74b0\u5883"),(0,r.kt)("p",null,"Mainnet forking \u80cc\u5f8c\u7684\u904b\u4f5c\u6a5f\u5236\uff0c\u6982\u5ff5\u4e0a\u5c31\u662f\u6a21\u64ec\u4e00\u500b\u4eff\u9020 Ethereum mainnet \u7684 local testnet\uff0c\u8b93\u958b\u767c\u8005\u8aa4\u4ee5\u70ba\u81ea\u5df1\u662f\u8ddf mainnet \u4e92\u52d5\u3002"),(0,r.kt)("p",null,"\u7576\u958b\u767c\u8005\u547c\u53eb\u5408\u7d04\u6216\u767c\u9001 tx \u6642\uff0c\u5982\u679c\u8a72\u300c\u4eff\u9020\u7248\u300dlocal testnet \u67e5\u7121\u8cc7\u8a0a\uff08\u8a72\u8cc7\u8a0a\u53ef\u80fd\u662f\u7d00\u9304\u5728\u67d0\u500b\u6b77\u53f2 block \u7576\u4e2d\uff09\uff0c\u5247 Hardhat \u5957\u4ef6\u8f49\u5411\u6b78\u6a94\u7bc0\u9ede\uff08archive node\uff09\u8a62\u554f\u8cc7\u8a0a\u7684\u5167\u5bb9\uff0c\u4e26\u5c07\u56de\u50b3\u7684\u7d50\u679c\u7d93\u904e\u9069\u7576\u5305\u88dd\u5f8c\u4e1f\u7d66\u958b\u767c\u8005\u3002\u56e0\u6b64\uff0c\u958b\u767c\u8005\u5fc5\u9700\u4e3b\u52d5\u63d0\u4f9b\u5169\u500b\u689d\u4ef6\uff1a(1) archive node (2) \u6307\u5b9a\u7684\u5340\u584a\u9ad8\u5ea6\uff08\u4ee5\u6b64\u9ad8\u5ea6\u70ba\u57fa\u6e96\u5283\u5206\u51fa\u4f55\u8b02\u6b77\u53f2 block\uff09\u3002"),(0,r.kt)("p",null,"\u672c\u6587",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u6703"),"\u63d0\u4f9b Hardhat \u8207\u5176\u4ed6\u76f8\u95dc\u5957\u4ef6\u7684\u5b89\u88dd\u6307\u5f15\uff0c\u76f8\u95dc\u64cd\u4f5c\u7d30\u7bc0\u53ef\u4ee5\u53c3\u8003 LunDAO \u5176\u4ed6\u6559\u5b78\u6587\u7ae0\u3002\u82e5\u60a8\u5df2\u77e5\u9053\u5982\u4f55\u4f7f\u7528 Hardhat \u90e8\u5c6c ERC-20 \u5408\u7d04\uff0c\u5247\u672c\u6587\u6df1\u5ea6\u6070\u5de7\u9069\u5408\u60a8\u3002\u4ee5\u4e0b\u70ba\u7b46\u8005\u5df2\u6e2c\u8a66\u80fd\u5920\u6210\u529f\u904b\u884c\u672c\u6587\u7ae0\u6b65\u9a5f\u7684\u8edf\u786c\u9ad4\u689d\u4ef6\uff0c\u8acb\u8b80\u8005\u53c3\u914c\u4f7f\u7528\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Software",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Windows",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"OS\uff1aWindows 10 Pro 21H1 (w/o WSL)"),(0,r.kt)("li",{parentName:"ul"},"nodejs v14.17.4"),(0,r.kt)("li",{parentName:"ul"},"yarn 1.22.17"))),(0,r.kt)("li",{parentName:"ul"},"Linux",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"OS\uff1aUbuntu 20.04.4 LTS (GNU/Linux 5.4.0-1053-raspi aarch64)"),(0,r.kt)("li",{parentName:"ul"},"\u5176\u4ed6\u540c Windows \u8edf\u9ad4\u914d\u7f6e"))))),(0,r.kt)("li",{parentName:"ul"},"Hardware",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u57fa\u672c\u4e0a\u7121\u9650\u5236\uff0c\u4e0b\u5217\u70ba\u7d93\u904e\u6e2c\u8a66\u53ef\u884c\u7684\u7d44\u5408"),(0,r.kt)("li",{parentName:"ul"},"Windows\uff1aIntel Core i7-10510U (16GB) with 4G LTE cellular hotspot"),(0,r.kt)("li",{parentName:"ul"},"Linux\uff1aRaspberry Pi 4B (4GB) with 1Gbps network")))),(0,r.kt)("h2",{id:"\u91cd\u8981\u5fc5\u5099\u689d\u4ef6"},"\u91cd\u8981\u5fc5\u5099\u689d\u4ef6"),(0,r.kt)("p",null,"\u7531\u65bc mainnet forking \u7684\u904b\u4f5c\u904e\u7a0b\u9700\u8207 archive node \u4f5c\u4e92\u52d5\uff1b\u56e0\u6b64\uff0c",(0,r.kt)("strong",{parentName:"p"},"\u4f60\u5fc5\u9700\u6e96\u5099\u597d archive node")," \u4e26\u5c07 Hardhat \u9023\u63a5\u4e0a\u5b83\u3002\u6700\u76f4\u767d\u5730\u65b9\u5f0f\u5373\u900f\u904e Geth\u3001OpenEthereum \u7b49\u5de5\u5177\u81ea\u67b6\u7bc0\u9ede",(0,r.kt)("sup",{parentName:"p",id:"fnref-5"},(0,r.kt)("a",{parentName:"sup",href:"#fn-5",className:"footnote-ref"},"5")),"\uff0c\u6216\u53ef\u4f7f\u7528\u5e02\u9762\u4e0a\u77e5\u540d\u7684\u6578\u5bb6 SaaS \u7bc0\u9ede\u4f9b\u61c9\u5546\u4e4b\u670d\u52d9",(0,r.kt)("sup",{parentName:"p",id:"fnref-6"},(0,r.kt)("a",{parentName:"sup",href:"#fn-6",className:"footnote-ref"},"6")),"\u3002\u672c\u6587\u70ba\u6c42\u904e\u7a0b\u8f15\u9b06\u597d\u5b78\u7fd2\uff0c\u4ee5\u4e0b\u5c07\u642d\u914d Alchemy \u63d0\u4f9b\u7684\u670d\u52d9\u3002"),(0,r.kt)("p",null,"\u53e6\u5916\uff0c\u7531\u65bc Hardhat Network \u662f EVM-compatible blockchain\uff0c\u56e0\u6b64\u7406\u8ad6\u4e0a\u4efb\u4f55 EVM-compatible chain \u7684\u6b78\u6a94\u7bc0\u9ede\u7686\u6709\u6a5f\u6703\u4f7f\u7528 mainnet forking\uff0c\u4f46\u5be6\u969b\u4e0a\u53ef\u80fd\u8207 Ethereum mainnet \u76f8\u6bd4\u6709\u6240\u9650\u5236\uff0c\u7b46\u8005\u50c5\u53e6\u5916\u4f7f\u7528\u904e Polygon mainnet \u4ea6\u53ef\u9806\u5229\u904b\u4f5c\u3002"),(0,r.kt)("h2",{id:"step-1\u5efa\u7f6e\u74b0\u5883"},"Step 1\uff1a\u5efa\u7f6e\u74b0\u5883"),(0,r.kt)("p",null,"\u76ee\u6a19\uff1a\u6210\u529f\u555f\u52d5 Hardhat Network"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u65b0\u589e\u4e00\u500b\u7a7a\u767d\u8cc7\u6599\u593e\u300c",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat_fork"),"\u300d")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"$ mkdir hardhat_fork\n$ cd hardhat_fork\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u5b89\u88dd\u5fc5\u5099\u7684 JavaScript \u5957\u4ef6",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u70ba\u6c42\u6240\u6709\u8b80\u8005\u90fd\u80fd\u5728\u7b2c\u4e00\u6b21\u64cd\u4f5c\u6642\u6210\u529f\u5b8c\u6210\uff0c\u672c\u6587\u5c07\u6240\u6709\u5957\u4ef6\u5df2\u6307\u5b9a\u7248\u672c\u865f\u5b89\u88dd"),(0,r.kt)("li",{parentName:"ul"},"\u4f5c\u8005\u5efa\u8b70\u8b80\u8005\u5b78\u6703\u4e4b\u5f8c\uff0c\u4ee5\u4f7f\u7528\u6700\u65b0 stable version \u70ba\u4f73")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"$ yarn init # \u6c92\u6709\u60f3\u66f4\u52d5\u7684\u90e8\u5206\uff0c\u5c31\u6309 Enter \u9375\u5e36\u904e\u5373\u53ef\n...\n$ yarn add dotenv@16.0.0\n$ yarn add hardhat@2.8.4\n$ yarn add @nomiclabs/hardhat-waffle@2.0.2\n$ yarn add @nomiclabs/hardhat-web3@2.0.0\n$ yarn add @nomiclabs/hardhat-ethers@2.0.5\n$ yarn add web3@1.7.0\n$ yarn add ethers@5.5.4\n...\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u555f\u52d5 Hardhat Network \u521d\u59cb\u5316\u8a2d\u5b9a")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'$ yarn hardhat\nyarn run v1.22.15\n888    888                      888 888               888\n888    888                      888 888               888\n888    888                      888 888               888\n8888888888  8888b.  888d888 .d88888 88888b.   8888b.  888888\n888    888     "88b 888P"  d88" 888 888 "88b     "88b 888\n888    888 .d888888 888    888  888 888  888 .d888888 888\n888    888 888  888 888    Y88b 888 888  888 888  888 Y88b.\n888    888 "Y888888 888     "Y88888 888  888 "Y888888  "Y888\n\nWelcome to Hardhat v2.8.4\n\n? What do you want to do? \u2026\n  Create a basic sample project\n  Create an advanced sample project\n  Create an advanced sample project that uses TypeScript\n\u25b8 Create an empty hardhat.config.js # \u8acb\u9078\u64c7\u9019\u500b\u9078\u9805\uff0c\u4e26\u6309 Enter\n  Quit\n\n$ ls\nhardhat.config.js  node_modules  package.json  yarn.lock\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u4f60\u53ef\u4ee5\u767c\u73fe ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat_fork")," \u8cc7\u6599\u593e\u5e95\u4e0b\u591a\u4e86\u4e00\u500b\u540d\u70ba ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat.config.js")," \u7684\u6a94\u6848\uff1b\u5b83\u5c31\u662f\u7528\u4f86\u8abf\u6574 Hardhat Network \u548c\u5176\u4ed6 hardhat \u5957\u4ef6\u904b\u4f5c\u6a21\u5f0f\u7684\u91cd\u8981\u53c3\u6578\u6a94\u3002")),(0,r.kt)("h2",{id:"step-2\u8abf\u6574-hardhatconfigjs"},"Step 2\uff1a\u8abf\u6574 ",(0,r.kt)("inlineCode",{parentName:"h2"},"hardhat.config.js")),(0,r.kt)("p",null,"\u76ee\u6a19\uff1a\u8a2d\u5b9a\u9032\u884c mainnet forking \u6240\u9700\u7684\u76f8\u95dc\u53c3\u6578"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat_fork")," \u8cc7\u6599\u593e\uff0c\u65b0\u589e\u4e00\u500b\u7a7a\u767d\u6a94\u6848\u53eb\u505a ",(0,r.kt)("inlineCode",{parentName:"li"},".env"),"\uff0c\u4e26\u4ee5\u6587\u5b57\u7de8\u8f2f\u5668\u5c07\u4ee5\u4e0b\u5167\u5bb9\u63d2\u5165\u5176\u4e2d",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u8a18\u5f97\u5148\u524d\u5f80 Alchemy \u8a3b\u518a\u5e33\u865f\uff0c\u4e26\u5275\u7acb\u4e00\u500b\u7a7a\u767d app \u5c08\u6848\uff08\u9810\u8a2d\u53ef\u5b58\u53d6 archive node\uff09")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Mainnet = "https://eth-mainnet.alchemyapi.io/v2/<your_Alchemy_key>"\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u4efb\u4f55\u6587\u5b57\u7de8\u8f2f\u5668\uff0c\u5c0d ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat.config.js")," \u9032\u884c\u7de8\u8f2f\uff0c\u5c07\u6a94\u6848\u6539\u6210\u4ee5\u4e0b\u6a23\u5b50\uff08\u53ef\u4ee5\u76f4\u63a5\u8907\u88fd\u3001\u8cbc\u4e0a\uff0c\u53d6\u4ee3\u5168\u90e8\u6a94\u6848\u5167\u5bb9\uff09")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'require("@nomiclabs/hardhat-waffle");\nrequire("@nomiclabs/hardhat-web3");\nrequire("@nomiclabs/hardhat-ethers");\nrequire(\'dotenv\').config();\n\ntask("height", "Print the current block height")\n  .setAction(async (taskArgs) => {\n    const block_height = await web3.eth.getBlockNumber();\n    console.log(`The current block height is ${block_height}`);\n  });\n\nmodule.exports = {\n  networks: {\n    hardhat: {\n      forking: {\n        url: process.env.Mainnet,\n        blockNumber: 14297759\n      }\n    }\n  }\n};\n// \u9ad8\u5ea6 14297759 \u767c\u751f\u5728 2022-03-01 00:00:18 (UTC+0)\uff0c\u9078\u64c7\u6b64\u6578\u5b57\u65b9\u4fbf\u5f8c\u7e8c\u89e3\u8aaa\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u70ba\u4ec0\u9ebc\u8981\u9019\u6a23\u8a2d\u5b9a\u5462\uff1f",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"task()")," \u7684\u7a0b\u5f0f\u7247\u6bb5\u76ee\u7684\u662f\u5275\u9020\u80fd\u5370\u51fa\u76ee\u524d\u5340\u584a\u9ad8\u5ea6\u7684\u6307\u4ee4\uff08\u4ee5 Hardhat Network \u5206\u53c9\u51fa\u4f86\u7684\u4e3b\u7db2\u4f86\u770b\uff09\uff0c\u95dc\u65bc task \u7684\u7de8\u5beb\u65b9\u6cd5\u8a73\u898b\u6587\u672b\u7684\u5ef6\u4f38\u95b1\u8b80"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"network")," \u9805\u76ee\u5e95\u4e0b\uff0c\u6211\u5011\u8a2d\u5b9a ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat")," \u7db2\u8def\u7684\u76f8\u95dc\u53c3\u6578\uff0c\u5305\u542b archive node \u7684\u5b58\u53d6\u7db2\u5740\u8207\u5206\u53c9\u9ad8\u5ea6"),(0,r.kt)("li",{parentName:"ul"},"\u7531\u65bc ",(0,r.kt)("inlineCode",{parentName:"li"},"network")," \u9805\u76ee\u5e95\u4e0b\u53ef\u4ee5\u540c\u6642\u8a2d\u5b9a\u591a\u500b\u4e0d\u540c\u7684\u7db2\u8def\uff0c\u4ee5\u4e0b\u70ba\u7c21\u6613\u7bc4\u4f8b\uff0c\u8a73\u7d30\u8fa6\u6cd5\u8acb\u53c3\u898b\u6587\u672b\u5ef6\u4f38\u95b1\u8b80")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  solidity: {...},\n  networks: {\n    arbitrum: {\n      url: process.env.Arbitrum, \n      accounts: [process.env.PriKey0, process.env.PriKey1]\n    },\n    hardhat: {...}\n  }\n};\n")),(0,r.kt)("h2",{id:"step-3\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7684-hardhat-task-height"},"Step 3\uff1a\u4f7f\u7528\u81ea\u5b9a\u7fa9\u7684 Hardhat task ",(0,r.kt)("inlineCode",{parentName:"h2"},"height")),(0,r.kt)("p",null,"\u76ee\u6a19\uff1a\u900f\u904e\u81ea\u5b9a\u7fa9\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"height")," task \u4f86\u78ba\u8a8d mainnet forking \u53ef\u6b63\u5e38\u904b\u4f5c"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5217\u51fa\u6240\u6709\u53ef\u7528\u7684 Hardhat task",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'--network "hardhat"')," \u4ee3\u8868\u547d\u4ee4 Hardhat \u4f7f\u7528 Hardhat Network"),(0,r.kt)("li",{parentName:"ul"},"\u5982\u679c\u8b80\u8005\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat.config.js")," \u88e1\u9762\u8a2d\u7f6e\u5176\u4ed6\u7db2\u8def\uff0c\u5247\u53ef\u900f\u904e\u6b64\u53c3\u6578\u96a8\u6642\u5207\u63db\u7db2\u8def"),(0,r.kt)("li",{parentName:"ul"},"\u6211\u5011\u53ef\u4ee5\u767c\u73fe\u5230\u300c",(0,r.kt)("inlineCode",{parentName:"li"},"AVAILABLE TASKS"),"\u300d\u51fa\u73fe\u4e86\u4e00\u884c ",(0,r.kt)("inlineCode",{parentName:"li"},"height Print the current block height")," \u6587\u5b57\uff0c\u8207\u7a0d\u65e9\u6211\u5011\u5728 ",(0,r.kt)("inlineCode",{parentName:"li"},"hardhat.config.js")," \u64b0\u5beb\u7684\u5167\u5bb9\u4e00\u81f4")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},"$ yarn hardhat --network \"hardhat\" help\nyarn run v1.22.17\nHardhat version 2.8.4\n\nUsage: hardhat [GLOBAL OPTIONS] <TASK> [TASK OPTIONS]\n\nGLOBAL OPTIONS:\n  --config              A Hardhat config file.\n  --emoji               Use emoji in messages.\n  --help                Shows this message, or a task's help if its name is provided\n  --max-memory          The maximum amount of memory that Hardhat can use.\n  --network             The network to connect to.\n  --show-stack-traces   Show stack traces.\n  --tsconfig            A TypeScript config file.\n  --verbose             Enables Hardhat verbose logging\n  --version             Shows hardhat's version.\n\nAVAILABLE TASKS:\n  check         Check whatever you need\n  clean         Clears the cache and deletes all artifacts\n  compile       Compiles the entire project, building all artifacts\n  console       Opens a hardhat console\n  flatten       Flattens and prints contracts and their dependencies\n  height        Print the current block height\n  help          Prints this message\n  node          Starts a JSON-RPC server on top of Hardhat Network\n  run           Runs a user-defined script after compiling the project\n  test          Runs mocha tests\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u904b\u884c ",(0,r.kt)("inlineCode",{parentName:"li"},"height")," \u6307\u4ee4",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"\u7531\u65bc\u76ee\u524d Ethereum \u7684\u6700\u65b0\u5340\u584a\u9ad8\u5ea6\u5fc5\u5b9a\u4e0d\u53ea 14297759\uff0c\u56e0\u6b64\u53ef\u898b\u6211\u5011\u5df2\u6210\u529f\u5275\u9020\u4e00\u500b\u5168\u65b0\u7684 mainnet forking \u74b0\u5883")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'$ yarn hardhat --network "hardhat" height\nyarn run v1.22.17\nThe current block height is 14297759\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u5229\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"node")," \u6307\u4ee4\uff0c\u958b\u59cb\u904b\u4f5c Hardhat Network \u7bc0\u9ede",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"\u8acb\u6ce8\u610f"),"\uff1a\u9019\u4e9b\u5730\u5740\u8207\u79c1\u9470\u90fd\u7531\u5df2\u77e5\u7684 key derivation \u904e\u7a0b",(0,r.kt)("sup",{parentName:"li",id:"fnref-7"},(0,r.kt)("a",{parentName:"sup",href:"#fn-7",className:"footnote-ref"},"7")),"\u7522\u751f\uff1b\u63db\u53e5\u8a71\u8aaa\uff0c\u4efb\u4f55\u4f7f\u7528 Hardhat \u7684\u958b\u767c\u8005\u7686\u77e5\u9019\u4e9b\u79c1\u9470\uff0c\u56e0\u6b64",(0,r.kt)("strong",{parentName:"li"},"\u5207\u52ff\u5728\u516c\u958b\u7db2\u8def\u5c07\u6771\u897f\u50b3\u9001\u9032\u9019\u4e9b\u5730\u5740\uff01")),(0,r.kt)("li",{parentName:"ul"},"\u524d\u6587\u5df2\u63d0\u904e Hardhat Network \u9810\u8a2d\u63d0\u4f9b 20 \u500b\u5404\u5177 10000 ETH \u7684\u5e33\u865f\u4f9b\u958b\u767c\u8005\u81ea\u7531\u4f7f\u7528"),(0,r.kt)("li",{parentName:"ul"},"\u642d\u914d\u6211\u5011\u73fe\u5df2\u5b78\u6703\u7684 mainnet forking \u6280\u5de7\uff0c\u5247\u53ef\u958b\u59cb\u4f7f\u7528\u9019\u4e9b\u5e7e\u4e4e\u7528\u4e0d\u5b8c\u7684 ETH \uff0c\u5728\u81ea\u5df1\u7684 local testnet \u505a\u5404\u985e\u958b\u767c")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Shell"},'$ yarn hardhat --network "hardhat" node\nyarn run v1.22.17\nStarted HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/\n\nAccounts\n========\n\nWARNING: These accounts, and their private keys, are publicly known.\nAny funds sent to them on Mainnet or any other live network WILL BE LOST.\n\nAccount #0: 0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266 (10000 ETH)\nPrivate Key: ...\n\nAccount #1: 0x70997970c51812dc3a010c7d01b50e0d17dc79c8 (10000 ETH)\nPrivate Key: ...\n\n...\n\nAccount #19: 0x8626f6940e2eb28930efb4cef49b2d1f2c9c1199 (10000 ETH)\nPrivate Key: ...\n\nWARNING: These accounts, and their private keys, are publicly known.\nAny funds sent to them on Mainnet or any other live network WILL BE LOST.\n')),(0,r.kt)("p",null,"\u672c\u6587\u5230\u6b64\u5df2\u5b8c\u6210\u6240\u6709\u6b65\u9a5f\uff0c\u606d\u559c\u5404\u4f4d\u8b80\u8005\u5df2\u5b78\u6703\u5982\u4f55\u4f7f\u7528 Hardhat \u9032\u884c mainnet forking\u3002\u53e6\u4e00\u7bc7",(0,r.kt)("a",{parentName:"p",href:"/blog/hardhat-forking-2"},"\u6587\u7ae0"),"\u5c07\u64cd\u4f5c\u7c21\u55ae\u7684\u7bc4\u4f8b\uff0c\u5411\u6709\u8208\u8da3\u7684\u8b80\u8005\u5c55\u793a Hardhat Network \u7684\u6709\u8da3\u61c9\u7528\u3002"),(0,r.kt)("h2",{id:"related-resources"},"Related resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Yarn",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://classic.yarnpkg.com/en/"},"https://classic.yarnpkg.com/en/")))),(0,r.kt)("li",{parentName:"ul"},"Hardhat",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"GitHub\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://github.com/NomicFoundation/hardhat"},"https://github.com/NomicFoundation/hardhat")),(0,r.kt)("li",{parentName:"ul"},"Mainnet forking\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/hardhat-network/guides/mainnet-forking.html"},"https://hardhat.org/hardhat-network/guides/mainnet-forking.html")),(0,r.kt)("li",{parentName:"ul"},"Configuration\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/config/"},"https://hardhat.org/config/")),(0,r.kt)("li",{parentName:"ul"},"Hardhat Network Reference\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/hardhat-network/reference/"},"https://hardhat.org/hardhat-network/reference/")),(0,r.kt)("li",{parentName:"ul"},"Creating a task\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/guides/create-task.html"},"https://hardhat.org/guides/create-task.html")),(0,r.kt)("li",{parentName:"ul"},"Hardhat Runtime Environment (HRE)\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/advanced/hardhat-runtime-environment.html"},"https://hardhat.org/advanced/hardhat-runtime-environment.html")))),(0,r.kt)("li",{parentName:"ul"},"Alchemy",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.alchemy.com/"},"https://www.alchemy.com/")))),(0,r.kt)("li",{parentName:"ul"},"Ethereum on ARM",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://ethereum-on-arm-documentation.readthedocs.io/en/latest/quick-guide/about-quick-start.html"},"https://ethereum-on-arm-documentation.readthedocs.io/en/latest/quick-guide/about-quick-start.html")))),(0,r.kt)("li",{parentName:"ul"},"Wrapped Ether",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://weth.io/index.html"},"https://weth.io/index.html"))))),(0,r.kt)("h2",{id:"further-reading"},"Further reading"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Infura",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://infura.io/"},"https://infura.io/")))),(0,r.kt)("li",{parentName:"ul"},"QuickNode",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.quicknode.com/"},"https://www.quicknode.com/")))),(0,r.kt)("li",{parentName:"ul"},"Truffle",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Simulate Live Networks with Forked Sandboxes\uff1a",(0,r.kt)("a",{parentName:"li",href:"https://trufflesuite.com/blog/sandbox-forking-with-truffle-teams/index.html"},"https://trufflesuite.com/blog/sandbox-forking-with-truffle-teams/index.html"))))),(0,r.kt)("div",{className:"footnotes"},(0,r.kt)("hr",{parentName:"div"}),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol",id:"fn-1"},"\u4f8b\u5982\uff1aRinkeby\u3001Goerli\u3001Kintsugi \u7b49",(0,r.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-2"},"\u53ef\u80fd\u56e0\u4e0d\u540c testnet \u5171\u8b58\u6a5f\u5236\uff0c\u800c\u8207\u4e3b\u7db2\u7565\u6709\u5dee\u7570\uff0c\u4f46\u662f\u4e00\u822c\u4f86\u8aaa\u5f88\u7f55\u898b\u51fa\u73fe Dapp \u80fd\u5920\u904b\u884c\u65bc testnet \u537b\u7121\u6cd5\u904b\u884c\u65bc mainnet\uff0c\u5c24\u5176\u6240\u6709\u7db2\u8def\u7684 EVM \u5be6\u4f5c\u7d30\u7bc0\u5747\u76f8\u540c",(0,r.kt)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-3"},(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/hardhat-network/guides/mainnet-forking.html#mainnet-forking"},"https://hardhat.org/hardhat-network/guides/mainnet-forking.html#mainnet-forking"),(0,r.kt)("a",{parentName:"li",href:"#fnref-3",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-5"},"\u900f\u904e\u6a39\u6885\u6d3e 4B \u53ef\u4ee5\u642d\u5efa\u6b78\u6a94\u7bc0\u9ede\uff0c\u4e0d\u4ee5\u6316\u7926\u70ba\u76ee\u7684\u4f86\u642d\u5efa\u6b78\u6a94\u7bc0\u9ede\u975e\u96e3\u4e8b\uff0c\u53ea\u9700\u8981\u6e96\u5099\u5927\u5bb9\u91cf\u7684 SATA3 SSD \u5373\u53ef\uff0c\u8a73\u7d30\u8acb\u53c3\u8003\u6587\u672b\u7684\u5ef6\u4f38\u95b1\u8b80 Ethereum on ARM",(0,r.kt)("a",{parentName:"li",href:"#fnref-5",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-6"},"Infura\u3001Alchemy\u3001QuickNode \u5747\u6709\u63d0\u4f9b\u5b58\u53d6\u6b78\u6a94\u7bc0\u9ede\u7684\u670d\u52d9\uff0c\u5176\u4e2d Alchemy \u5728\u4f5c\u8005\u64b0\u6587\u6642\u70ba\u514d\u8cbb\u670d\u52d9\u3002",(0,r.kt)("a",{parentName:"li",href:"#fnref-6",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-7"},"\u6709\u8208\u8da3\u7684\u8b80\u8005\u8acb\u53c3\u898b\u9019\u500b\u9023\u7d50 ",(0,r.kt)("a",{parentName:"li",href:"https://hardhat.org/hardhat-network/reference/#accounts"},"https://hardhat.org/hardhat-network/reference/#accounts"),(0,r.kt)("a",{parentName:"li",href:"#fnref-7",className:"footnote-backref"},"\u21a9")))))}s.isMDXComponent=!0}}]);